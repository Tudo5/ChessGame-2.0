<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VSCode Chess & Checkers</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    /*************************
     *  ШАХМАТЫ (твой код, без изменений)
     *************************/
    const pieceSets = {
      classic: { wK: "♔", wQ: "♕", wR: "♖", wB: "♗", wN: "♘", wP: "♙", bK: "♚", bQ: "♛", bR: "♜", bB: "♝", bN: "♞", bP: "♟" },
      emerald: { wK: "♚", wQ: "♛", wR: "♜", wB: "♝", wN: "♞", wP: "♟", bK: "♔", bQ: "♕", bR: "♖", bB: "♗", bN: "♘", bP: "♙" },
      ocean: { wK: "🦑", wQ: "🐋", wR: "🦀", wB: "🐠", wN: "🐬", wP: "🐚", bK: "🦑", bQ: "🐋", bR: "🦀", bB: "🐠", bN: "🐬", bP: "🐚" },
      purple: { wK: "👑", wQ: "💎", wR: "🏰", wB: "🔮", wN: "🦄", wP: "⭐", bK: "☠️", bQ: "🌑", bR: "⚔️", bB: "👻", bN: "🐉", bP: "🕸️" },
    };

    const themes = [
      { name: "Classic", key: "classic", light: "linear-gradient(135deg,#f0d9b5,#fff5e1)", dark: "linear-gradient(135deg,#b58863,#8b5e3c)", pieceStyle: { white: { color: "#fff", textShadow: "0 0 2px black" }, black: { color: "#000" } } },
      { name: "Emerald", key: "emerald", light: "linear-gradient(135deg,#d1fae5,#a7f3d0)", dark: "linear-gradient(135deg,#10b981,#065f46)", pieceStyle: { white: { color: "#34d399", textShadow: "0 0 3px #064e3b" }, black: { color: "#064e3b" } } },
      { name: "Ocean", key: "ocean", light: "linear-gradient(135deg,#e0f2fe,#bae6fd)", dark: "linear-gradient(135deg,#0284c7,#075985)", pieceStyle: { white: { color: "#38bdf8", textShadow: "0 0 3px #0c4a6e" }, black: { color: "#0c4a6e" } } },
      { name: "Purple", key: "purple", light: "linear-gradient(135deg,#ede9fe,#ddd6fe)", dark: "linear-gradient(135deg,#7c3aed,#4c1d95)", pieceStyle: { white: { color: "#c4b5fd", textShadow: "0 0 3px #312e81" }, black: { color: "#312e81" } } }
    ];

    const initialBoard = () => {
      const empty = Array(8).fill(null).map(() => Array(8).fill(null));
      const back = ["R", "N", "B", "Q", "K", "B", "N", "R"];
      for (let i = 0; i < 8; i++) empty[0][i] = { color: "b", kind: back[i] };
      for (let i = 0; i < 8; i++) empty[1][i] = { color: "b", kind: "P" };
      for (let i = 0; i < 8; i++) empty[6][i] = { color: "w", kind: "P" };
      for (let i = 0; i < 8; i++) empty[7][i] = { color: "w", kind: back[i] };
      return empty;
    };

    function cloneBoard(b) { return b.map(r => r.map(c => c ? { ...c } : null)); }

    function getMoves(board, r, c) {
      const cell = board[r][c]; if (!cell) return [];
      const { color, kind } = cell; const dir = color === "w" ? -1 : 1;
      const moves = []; const inB = (x, y) => x >= 0 && x < 8 && y >= 0 && y < 8;
      const push = (x, y) => { if (!inB(x, y)) return; const t = board[x][y]; if (!t || t.color !== color) moves.push([x, y]); };
      if (kind === "P") {
        const one = r + dir, two = r + 2 * dir;
        if (inB(one, c) && !board[one][c]) {
          moves.push([one, c]);
          const start = color === "w" ? 6 : 1;
          if (r === start && inB(two, c) && !board[two][c]) moves.push([two, c]);
        }
        for (let dy of [-1, 1]) {
          const x = r + dir, y = c + dy;
          if (inB(x, y) && board[x][y] && board[x][y].color !== color) moves.push([x, y]);
        }
      } else if (kind === "N") {
        for (let [dx, dy] of [[-2, -1], [-2, 1], [-1, -2], [-1, 2], [1, -2], [1, 2], [2, -1], [2, 1]]) push(r + dx, c + dy);
      } else if (["B", "R", "Q"].includes(kind)) {
        const dirs = [];
        if (["B", "Q"].includes(kind)) dirs.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
        if (["R", "Q"].includes(kind)) dirs.push([-1, 0], [1, 0], [0, -1], [0, 1]);
        for (let [dx, dy] of dirs) {
          let x = r + dx, y = c + dy;
          while (inB(x, y)) {
            if (!board[x][y]) { moves.push([x, y]); x += dx; y += dy; continue; }
            if (board[x][y].color !== color) moves.push([x, y]); break;
          }
        }
      } else if (kind === "K") {
        for (let dx = -1; dx <= 1; dx++)
          for (let dy = -1; dy <= 1; dy++) if (dx || dy) push(r + dx, c + dy);
      }
      return moves;
    }

    function isKingInCheck(board, color) {
      let kr, kc;
      for (let r = 0; r < 8; r++)
        for (let c = 0; c < 8; c++) {
          const p = board[r][c];
          if (p && p.color === color && p.kind === "K") { kr = r; kc = c; }
        }
      for (let r = 0; r < 8; r++)
        for (let c = 0; c < 8; c++) {
          const p = board[r][c];
          if (p && p.color !== color) {
            const moves = getMoves(board, r, c);
            if (moves.some(([mr, mc]) => mr === kr && mc === kc)) return true;
          }
        }
      return false;
    }

    function hasAnyMoves(board, color) {
      for (let r = 0; r < 8; r++)
        for (let c = 0; c < 8; c++) {
          const p = board[r][c];
          if (p && p.color === color) {
            const moves = getMoves(board, r, c);
            for (let [mr, mc] of moves) {
              const nb = cloneBoard(board);
              nb[mr][mc] = nb[r][c]; nb[r][c] = null;
              if (!isKingInCheck(nb, color)) return true;
            }
          }
        }
      return false;
    }

    function getGameState(board, turn) {
      const enemy = turn === "w" ? "b" : "w";
      if (!hasAnyMoves(board, turn)) {
        if (isKingInCheck(board, turn)) return { over: true, result: `Мат! Победили ${enemy === "w" ? "Белые" : "Чёрные"}` };
        else return { over: true, result: "Пат!" };
      }
      return { over: false, result: isKingInCheck(board, turn) ? "Шах!" : "" };
    }

    const values = { P: 1, N: 3, B: 3, R: 5, Q: 9, K: 1000 };
    function evaluate(board) {
      let score = 0;
      for (let r = 0; r < 8; r++)
        for (let c = 0; c < 8; c++) {
          const p = board[r][c];
          if (!p) continue;
          const v = values[p.kind];
          score += p.color === "w" ? v : -v;
        }
      return score;
    }

    function minimax(board, depth, maximizing, alpha = -Infinity, beta = Infinity) {
      if (depth === 0) return [evaluate(board), null];
      const color = maximizing ? "w" : "b"; let best = maximizing ? -Infinity : Infinity; let bestMove = null;
      const moves = [];
      for (let r = 0; r < 8; r++)
        for (let c = 0; c < 8; c++) {
          const p = board[r][c]; if (!p || p.color !== color) continue;
          for (let [mr, mc] of getMoves(board, r, c)) {
            const nb = cloneBoard(board);
            nb[mr][mc] = nb[r][c]; nb[r][c] = null;
            if (nb[mr][mc].kind === "P" && (mr === 0 || mr === 7)) nb[mr][mc].kind = "Q";
            if (!isKingInCheck(nb, color)) moves.push([[r, c], [mr, mc]]);
          }
        }
      const MAX_BRANCHES = 20; const limitedMoves = moves.slice(0, MAX_BRANCHES);
      for (let [[sr, sc], [r, c]] of limitedMoves) {
        const nb = cloneBoard(board); nb[r][c] = nb[sr][sc]; nb[sr][sc] = null;
        const [score] = minimax(nb, depth - 1, !maximizing, alpha, beta);
        if (maximizing) { if (score > best) { best = score; bestMove = [[sr, sc], [r, c]]; } alpha = Math.max(alpha, best); }
        else { if (score < best) { best = score; bestMove = [[sr, sc], [r, c]]; } beta = Math.min(beta, best); }
        if (beta <= alpha) break;
      }
      return [best, bestMove];
    }

    function pieceToUnicode(p, setKey) { return pieceSets[setKey][p.color + p.kind]; }

    function ChessGame() {
      const [board, setBoard] = React.useState(initialBoard());
      const [turn, setTurn] = React.useState("w");
      const [selected, setSelected] = React.useState(null);
      const [history, setHistory] = React.useState([]);
      const [mode, setMode] = React.useState("2p");
      const [difficulty, setDifficulty] = React.useState(3);
      const [status, setStatus] = React.useState("");

      const legalTargets = React.useMemo(() => {
        if (!selected) return [];
        const [r, c] = selected;
        return getMoves(board, r, c).map(([x, y]) => `${x},${y}`);
      }, [board, selected]);

      function movePiece(sr, sc, r, c) {
        const nb = cloneBoard(board);
        const p = nb[sr][sc]; nb[sr][sc] = null; nb[r][c] = p;
        if (p.kind === "P" && (r === 0 || r === 7)) p.kind = "Q";
        const nextTurn = turn === "w" ? "b" : "w";
        setBoard(nb); setTurn(nextTurn); setSelected(null);
        setHistory(h => [...h, `${pieceToUnicode(p, "classic")} → ${String.fromCharCode(97 + c)}${8 - r}`]);
        const state = getGameState(nb, nextTurn);
        setStatus(state.result);
      }

      function onSquareClick(r, c) {
        if (status.includes("Мат") || status.includes("Пат")) return;
        const piece = board[r][c];
        if (selected) {
          const [sr, sc] = selected;
          if (legalTargets.includes(`${r},${c}`)) { movePiece(sr, sc, r, c); }
          else if (piece && piece.color === turn) setSelected([r, c]);
          else setSelected(null);
        } else if (piece && piece.color === turn) setSelected([r, c]);
      }

      React.useEffect(() => {
        if (mode === "bot" && turn === "b" && !status.includes("Мат") && !status.includes("Пат")) {
          setTimeout(() => {
            const [_, move] = minimax(board, difficulty, false);
            if (move) { const [[sr, sc], [r, c]] = move; movePiece(sr, sc, r, c); }
          }, 300);
        }
      }, [turn, mode, board, status]);

      function reset() { setBoard(initialBoard()); setTurn("w"); setSelected(null); setHistory([]); setStatus(""); }

      return (
        <div className="p-4 min-h-screen flex flex-col items-center justify-start bg-gradient-to-br from-gray-900 to-gray-800 font-sans">

          {/* Режимы */}
          <div className="w-full max-w-[640px] flex justify-center gap-4 mb-4">
            <button onClick={() => setMode("2p")} className={`flex-1 px-5 py-3 rounded-lg font-semibold transition-all duration-150 ${mode === "2p" ? "bg-gradient-to-r from-yellow-700 to-orange-600 text-white shadow-md" : "bg-yellow-500 text-white hover:bg-yellow-600"} active:scale-95`}>2 Players</button>
            <button onClick={() => setMode("bot")} className={`flex-1 px-5 py-3 rounded-lg font-semibold transition-all duration-150 ${mode === "bot" ? "bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-md" : "bg-gray-600 text-gray-100 hover:bg-purple-500 hover:text-white"} active:scale-95`}>Vs Bot</button>
          </div>

          {/* Reset */}
          <div className="w-full max-w-[640px] flex justify-center mb-4">
            <button onClick={reset} className="w-full sm:w-1/2 px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-bold shadow-md transition-all duration-150 active:scale-95">Reset</button>
          </div>

          {/* Бот уровень */}
          {mode === "bot" && (
            <div className="w-full max-w-[640px] flex justify-center mb-4">
              <select value={difficulty} onChange={e => setDifficulty(+e.target.value)} className="w-full sm:w-3/4 px-6 py-4 text-lg rounded-lg font-bold bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg hover:from-purple-600 hover:to-pink-600 active:scale-95 transition-all duration-150 text-center">
                <option value={1}>Easy</option>
                <option value={2}>Medium</option>
                <option value={3}>Hard</option>
              </select>
            </div>
          )}

          <h2 className="text-2xl sm:text-3xl text-white mb-4 font-bold tracking-wide">Шахматы</h2>

          {/* Доска */}
          <div className="grid grid-cols-8 w-full max-w-[640px] aspect-square border-4 border-[#8B5E3C] rounded-md overflow-hidden">
            {board.map((row, r) => row.map((cell, c) => {
              const isLight = (r + c) % 2 === 0;
              const isSel = selected && selected[0] === r && selected[1] === c;
              const isTgt = legalTargets.includes(`${r},${c}`);
              return (
                <div key={`${r}-${c}`} onClick={() => onSquareClick(r, c)}
                  className={`relative aspect-square flex items-center justify-center cursor-pointer select-none transition-all duration-150 ${isLight ? "bg-[#F5DEB3]" : "bg-[#8B5E3C]"} ${isSel ? "outline-4 outline outline-yellow-400" : ""}`}>
                  {cell && (
                    <div className={`text-4xl sm:text-5xl transition-all duration-150 ${cell.color === "w" ? "text-white" : "text-black"}`}>
                      {pieceToUnicode(cell, "classic")}
                    </div>
                  )}
                  {isTgt && <div className="absolute w-4 h-4 sm:w-5 sm:h-5 bg-green-500 rounded-full"></div>}
                </div>
              )
            }))}
          </div>

          <div className="mt-4 text-white text-lg sm:text-xl font-semibold tracking-wide">Ход: {turn === "w" ? "Белые" : "Чёрные"}</div>
        </div>
      );
    }


    /*************************
     *  ШАШКИ (новый компонент)
     *************************/
    function CheckersGame() {
      const size = 8;
      const [board, setBoard] = React.useState(initBoard());
      const [turn, setTurn] = React.useState("w");
      const [selected, setSelected] = React.useState(null);
      const [moves, setMoves] = React.useState([]);
      const [mode, setMode] = React.useState("2p");
      const [difficulty, setDifficulty] = React.useState(1);
      const [animating, setAnimating] = React.useState(false);

      function initBoard() {
        const b = Array(size).fill(null).map(() => Array(size).fill(null));
        for (let r = 0; r < 3; r++)
          for (let c = 0; c < size; c++)
            if ((r + c) % 2 === 1) b[r][c] = { color: "b", king: false };
        for (let r = size - 3; r < size; r++)
          for (let c = 0; c < size; c++)
            if ((r + c) % 2 === 1) b[r][c] = { color: "w", king: false };
        return b;
      }

      function getMoves(r, c, b = board, path = [], captured = []) {
        const p = b[r][c];
        if (!p) return [];
        let dirs = p.king ? [[1, 1], [1, -1], [-1, 1], [-1, -1]] : (p.color === "w" ? [[-1, -1], [-1, 1]] : [[1, -1], [1, 1]]);
        let movesList = [];

        for (let [dr, dc] of dirs) {
          let nr = r + dr, nc = c + dc;
          while (nr >= 0 && nr < size && nc >= 0 && nc < size) {
            const target = b[nr][nc];
            if (!target && captured.length === 0) {
              movesList.push({ path: [...path, [nr, nc]], captured: [] });
            } else if (target && target.color !== p.color && !captured.some(pos => pos[0] === nr && pos[1] === nc)) {
              const jr = nr + dr, jc = nc + dc;
              if (jr >= 0 && jr < size && jc >= 0 && jc < size && !b[jr][jc]) {
                const nb = b.map(row => row.map(c => c ? { ...c } : null));
                nb[jr][jc] = nb[r][c]; nb[r][c] = null; nb[nr][nc] = null;
                const further = getMoves(jr, jc, nb, [...path, [jr, jc]], [...captured, [nr, nc]]);
                if (further.length > 0) movesList.push(...further);
                else movesList.push({ path: [...path, [jr, jc]], captured: [...captured, [nr, nc]] });
              }
              break;
            } else break;
            if (!p.king) break; // Пешка делает только один шаг
            nr += dr; nc += dc;
          }
        }
        return movesList;
      }

      function onClick(r, c) {
        if (animating) return;
        if (selected) {
          const sr = selected[0], sc = selected[1];
          const move = moves.find(m => {
            const last = m.path[m.path.length - 1];
            return last[0] === r && last[1] === c;
          });
          if (move) {
            performMove(sr, sc, move.path, move.captured, () => setTurn(turn === "w" ? "b" : "w"));
            setSelected(null); setMoves([]);
            return;
          }
          setSelected(null); setMoves([]);
        } else {
          const p = board[r][c];
          if (p && p.color === turn) {
            setSelected([r, c]);
            setMoves(getMoves(r, c));
          }
        }
      }
      function performMove(sr, sc, path, captured, callback) {
        setAnimating(true);
        const newBoard = board.map(row => row.map(c => c ? { ...c } : null));
        const piece = { ...newBoard[sr][sc] };
        newBoard[sr][sc] = null;

        const finalStep = path[path.length - 1];
        piece.king = piece.king || (piece.color === "w" && finalStep[0] === 0) || (piece.color === "b" && finalStep[0] === size - 1);

        // Сразу перемещаем шашку, убираем съеденные
        newBoard[finalStep[0]][finalStep[1]] = piece;
        captured.forEach(([cr, cc]) => newBoard[cr][cc] = null);
        setBoard(newBoard);
        setTimeout(() => { setAnimating(false); if (callback) callback(); }, 50); // быстрая анимация
      }

      function reset() {
        setBoard(initBoard());
        setTurn("w");
        setSelected(null);
        setMoves([]);
        setAnimating(false);
      }

      React.useEffect(() => {
        if (mode === "bot" && turn === "b" && !animating) {
          const allMoves = [];
          for (let r = 0; r < size; r++)
            for (let c = 0; c < size; c++) {
              const p = board[r][c];
              if (p && p.color === "b") {
                const mv = getMoves(r, c);
                mv.forEach(m => allMoves.push([[r, c], m]));
              }
            }
          if (allMoves.length > 0) {
            setTimeout(() => {
              let chosen;
              if (difficulty === 1) chosen = allMoves[Math.floor(Math.random() * allMoves.length)];
              else if (difficulty === 2) {
                allMoves.sort((a, b) => b[1].captured.length - a[1].captured.length);
                chosen = allMoves[0];
              } else {
                const maxCap = Math.max(...allMoves.map(m => m[1].captured.length));
                const best = allMoves.filter(m => m[1].captured.length === maxCap);
                chosen = best[Math.floor(Math.random() * best.length)];
              }
              const [[sr, sc], mv] = chosen;
              performMove(sr, sc, mv.path, mv.captured, () => setTurn("w"));
            }, 100);
          }
        }
      }, [board, turn, mode, difficulty, animating]);

      return (
        <div className="p-4 min-h-screen flex flex-col items-center justify-start bg-gradient-to-br from-gray-900 to-gray-800 font-sans">

          {/* Режимы */}
          <div className="w-full max-w-[640px] flex justify-center gap-4 mb-4">
            <button onClick={() => setMode("2p")} className={`flex-1 px-5 py-3 rounded-lg font-semibold transition-all duration-150 ${mode === "2p" ? "bg-gradient-to-r from-yellow-700 to-orange-600 text-white shadow-md" : "bg-yellow-500 text-white hover:bg-yellow-600"} active:scale-95`}>2 Players</button>
            <button onClick={() => setMode("bot")} className={`flex-1 px-5 py-3 rounded-lg font-semibold transition-all duration-150 ${mode === "bot" ? "bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-md" : "bg-gray-600 text-gray-100 hover:bg-purple-500 hover:text-white"} active:scale-95`}>Vs Bot</button>
          </div>

          {/* Reset */}
          <div className="w-full max-w-[640px] flex justify-center mb-4">
            <button onClick={reset} className="w-full sm:w-1/2 px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-bold shadow-md transition-all duration-150 active:scale-95">Reset</button>
          </div>

          {/* Бот уровень */}
          {mode === "bot" && (
            <div className="w-full max-w-[640px] flex justify-center mb-4">
              <select value={difficulty} onChange={e => setDifficulty(+e.target.value)} className="w-full sm:w-3/4 px-6 py-4 text-lg rounded-lg font-bold bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg hover:from-purple-600 hover:to-pink-600 active:scale-95 transition-all duration-150 text-center">
                <option value={1}>Easy</option>
                <option value={2}>Medium</option>
                <option value={3}>Hard</option>
              </select>
            </div>
          )}

          <h2 className="text-2xl sm:text-3xl text-white mb-4 font-bold tracking-wide">Шашки</h2>

          {/* Доска */}
          <div className="grid grid-cols-8 w-full max-w-[640px] aspect-square border-4 border-[#8B5E3C] rounded-md overflow-hidden">
            {board.map((row, r) => row.map((cell, c) => {
              const isLight = (r + c) % 2 === 0;
              const isSel = selected && selected[0] === r && selected[1] === c;
              const isMove = moves.some(m => {
                const last = m.path[m.path.length - 1];
                return last[0] === r && last[1] === c;
              });
              return (
                <div key={`${r}-${c}`} onClick={() => onClick(r, c)}
                  className={`relative aspect-square flex items-center justify-center cursor-pointer select-none transition-all duration-150 ${isLight ? "bg-[#F5DEB3]" : "bg-[#8B5E3C]"} ${isSel ? "outline-4 outline outline-yellow-400" : ""}`}>
                  {cell && (
                    <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center text-2xl sm:text-3xl transition-all duration-150 ${cell.color === "w" ? "bg-white text-black" : "bg-black text-white"}`}>
                      {cell.king ? "👑" : ""}
                    </div>
                  )}
                  {isMove && <div className="absolute w-4 h-4 sm:w-5 sm:h-5 bg-green-500 rounded-full"></div>}
                </div>
              )
            }))}
          </div>

          <div className="mt-4 text-white text-lg sm:text-xl font-semibold tracking-wide">Ход: {turn === "w" ? "Белые" : "Чёрные"}</div>
        </div>
      );
    }
    /*************************
     *  APP: переключение
     *************************/
    function App() {
      const [game, setGame] = React.useState("chess");
      return (
        <div>ф
          <div className="flex gap-2 p-4 bg-gray-800 text-white">
            <button onClick={() => setGame("chess")} className={`px-4 py-2 rounded ${game === "chess" ? "bg-blue-500" : "bg-gray-600"}`}>Шахматы</button>
            <button onClick={() => setGame("checkers")} className={`px-4 py-2 rounded ${game === "checkers" ? "bg-blue-500" : "bg-gray-600"}`}>Шашки</button>
          </div>
          {game === "chess" ? <ChessGame /> : <CheckersGame />}
        </div>
      );
    }
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>

</html>
