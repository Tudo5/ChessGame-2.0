<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–®–∞—Ö–º–∞—Ç—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">

        // ‚ôüÔ∏è –†–∞–∑–Ω—ã–µ —Ñ–∏–≥—É—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º
        const pieceSets = {
            classic: {
                wK: "‚ôî", wQ: "‚ôï", wR: "‚ôñ", wB: "‚ôó", wN: "‚ôò", wP: "‚ôô",
                bK: "‚ôö", bQ: "‚ôõ", bR: "‚ôú", bB: "‚ôù", bN: "‚ôû", bP: "‚ôü",
            },
            emerald: {
                wK: "‚ôö", wQ: "‚ôõ", wR: "‚ôú", wB: "‚ôù", wN: "‚ôû", wP: "‚ôü",
                bK: "‚ôî", bQ: "‚ôï", bR: "‚ôñ", bB: "‚ôó", bN: "‚ôò", bP: "‚ôô",
            },
            ocean: {
                wK: "ü¶ë", wQ: "üêã", wR: "ü¶Ä", wB: "üê†", wN: "üê¨", wP: "üêö",
                bK: "ü¶ë", bQ: "üêã", bR: "ü¶Ä", bB: "üê†", bN: "üê¨", bP: "üêö",
            },
            purple: {
                wK: "üëë", wQ: "üíé", wR: "üè∞", wB: "üîÆ", wN: "ü¶Ñ", wP: "‚≠ê",
                bK: "‚ò†Ô∏è", bQ: "üåë", bR: "‚öîÔ∏è", bB: "üëª", bN: "üêâ", bP: "üï∏Ô∏è",
            },
        };

        // üé® –¢–µ–º—ã
        const themes = [
            {
                name: "Classic",
                key: "classic",
                light: "linear-gradient(135deg, #f0d9b5, #fff5e1)",
                dark: "linear-gradient(135deg, #b58863, #8b5e3c)",
            },
            {
                name: "Emerald",
                key: "emerald",
                light: "linear-gradient(135deg, #d1fae5, #a7f3d0)",
                dark: "linear-gradient(135deg, #10b981, #065f46)",
            },
            {
                name: "Ocean",
                key: "ocean",
                light: "linear-gradient(135deg, #e0f2fe, #bae6fd)",
                dark: "linear-gradient(135deg, #0284c7, #075985)",
            },
            {
                name: "Purple Dream",
                key: "purple",
                light: "linear-gradient(135deg, #ede9fe, #ddd6fe)",
                dark: "linear-gradient(135deg, #7c3aed, #4c1d95)",
            },
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
        const initialBoard = () => {
            const empty = Array(8).fill(null).map(() => Array(8).fill(null));
            const backRank = ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R'];
            for (let i = 0; i < 8; i++) empty[0][i] = { color: 'b', kind: backRank[i] };
            for (let i = 0; i < 8; i++) empty[1][i] = { color: 'b', kind: 'P' };
            for (let i = 0; i < 8; i++) empty[6][i] = { color: 'w', kind: 'P' };
            for (let i = 0; i < 8; i++) empty[7][i] = { color: 'w', kind: backRank[i] };
            return empty;
        };

        function cloneBoard(board) {
            return board.map(row => row.map(cell => cell ? { ...cell } : null));
        }

        function getMoves(board, r, c) {
            const cell = board[r][c];
            if (!cell) return [];
            const { color, kind } = cell;
            const dir = color === 'w' ? -1 : 1;
            const moves = [];
            const inBounds = (x, y) => x >= 0 && x < 8 && y >= 0 && y < 8;
            const pushIf = (x, y) => {
                if (!inBounds(x, y)) return;
                const target = board[x][y];
                if (!target || target.color !== color) moves.push([x, y]);
            };

            if (kind === 'P') {
                const one = r + dir; const two = r + dir * 2;
                if (inBounds(one, c) && !board[one][c]) {
                    moves.push([one, c]);
                    const startRow = (color === 'w' ? 6 : 1);
                    if (r === startRow && inBounds(two, c) && !board[two][c]) moves.push([two, c]);
                }
                for (let dy of [-1, 1]) {
                    const x = r + dir, y = c + dy;
                    if (inBounds(x, y) && board[x][y] && board[x][y].color !== color) moves.push([x, y]);
                }
            } else if (kind === 'N') {
                const deltas = [[-2, -1], [-2, 1], [-1, -2], [-1, 2], [1, -2], [1, 2], [2, -1], [2, 1]];
                deltas.forEach(([dx, dy]) => pushIf(r + dx, c + dy));
            } else if (kind === 'B' || kind === 'R' || kind === 'Q') {
                const directions = [];
                if (kind === 'B' || kind === 'Q') directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
                if (kind === 'R' || kind === 'Q') directions.push([-1, 0], [1, 0], [0, -1], [0, 1]);
                for (let [dx, dy] of directions) {
                    let x = r + dx, y = c + dy;
                    while (inBounds(x, y)) {
                        if (!board[x][y]) { moves.push([x, y]); x += dx; y += dy; continue; }
                        if (board[x][y].color !== color) moves.push([x, y]);
                        break;
                    }
                }
            } else if (kind === 'K') {
                for (let dx = -1; dx <= 1; dx++)
                    for (let dy = -1; dy <= 1; dy++)
                        if (dx !== 0 || dy !== 0) pushIf(r + dx, c + dy);
            }
            return moves;
        }

        function ChessGame() {
            const [board, setBoard] = React.useState(initialBoard());
            const [turn, setTurn] = React.useState('w');
            const [selected, setSelected] = React.useState(null);
            const [themeIndex, setThemeIndex] = React.useState(0);
            const [winner, setWinner] = React.useState(null);
            const [check, setCheck] = React.useState(null);

            const theme = themes[themeIndex];
            const pieces = pieceSets[theme.key];

            const legalTargets = React.useMemo(() => {
                if (!selected) return [];
                const [r, c] = selected;
                return getMoves(board, r, c).map(([x, y]) => `${x},${y}`);
            }, [board, selected]);

            const isKingAlive = (color, b = board) => {
                return b.some(row => row.some(cell => cell?.color === color && cell.kind === "K"));
            };

            const onSquareClick = (r, c) => {
                const piece = board[r][c];
                if (selected) {
                    const [sr, sc] = selected;
                    const allowed = legalTargets.includes(`${r},${c}`);
                    if (allowed) {
                        const newBoard = cloneBoard(board);
                        newBoard[r][c] = newBoard[sr][sc];
                        newBoard[sr][sc] = null;
                        if (newBoard[r][c].kind === 'P' && (r === 0 || r === 7)) newBoard[r][c].kind = 'Q';
                        setBoard(newBoard);
                        setSelected(null);

                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–∞
                        if (!isKingAlive(turn === "w" ? "b" : "w", newBoard)) {
                            setWinner(turn);
                        } else {
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ö–∞ (–µ—Å–ª–∏ —É–≥—Ä–æ–∂–∞—é—Ç –∫–æ—Ä–æ–ª—é —Å–æ–ø–µ—Ä–Ω–∏–∫–∞)
                            const enemy = turn === "w" ? "b" : "w";
                            let kingPos = null;
                            newBoard.forEach((row, i) =>
                                row.forEach((cell, j) => {
                                    if (cell?.color === enemy && cell.kind === "K") kingPos = [i, j];
                                })
                            );
                            let underAttack = false;
                            if (kingPos) {
                                newBoard.forEach((row, i) =>
                                    row.forEach((cell, j) => {
                                        if (cell?.color === turn) {
                                            const moves = getMoves(newBoard, i, j);
                                            if (moves.some(([x, y]) => x === kingPos[0] && y === kingPos[1])) {
                                                underAttack = true;
                                            }
                                        }
                                    })
                                );
                            }
                            setCheck(underAttack ? enemy : null);

                            setTurn(turn === 'w' ? 'b' : 'w');
                        }
                    } else {
                        if (piece && piece.color === turn) setSelected([r, c]);
                        else setSelected(null);
                    }
                } else {
                    if (piece && piece.color === turn) setSelected([r, c]);
                }
            };

            const reset = () => {
                setBoard(initialBoard());
                setTurn("w");
                setSelected(null);
                setWinner(null);
                setCheck(null);
            };

            return (
                <div className="p-6 min-h-screen flex items-start justify-center bg-gradient-to-br from-gray-900 to-gray-800 font-sans">
                    <div className="max-w-5xl w-full grid grid-cols-3 gap-6">

                        {/* –î–æ—Å–∫–∞ */}
                        <div className="col-span-2">
                            <div className="p-4 rounded-xl shadow-xl bg-white/5">
                                <div className="flex items-center justify-between mb-3">
                                    <h2 className="text-white text-2xl font-semibold">–®–∞—Ö–º–∞—Ç—ã</h2>
                                    <div className="text-sm text-gray-200">
                                        –•–æ–¥: <span className="font-bold">{turn === "w" ? "–ë–µ–ª—ã–µ" : "–ß—ë—Ä–Ω—ã–µ"}</span>
                                    </div>
                                </div>

                                {check && (
                                    <div className="mb-2 text-yellow-400 font-bold text-lg">–í–∞–º —à–∞—Ö!</div>
                                )}

                                <div
                                    className="grid grid-cols-8 border rounded-md overflow-hidden"
                                    style={{ width: "min(640px, 90vw)" }}
                                >
                                    {board.map((row, r) =>
                                        row.map((cell, c) => {
                                            const isLight = (r + c) % 2 === 0;
                                            const isSelected =
                                                selected && selected[0] === r && selected[1] === c;
                                            const isTarget = legalTargets.includes(`${r},${c}`);
                                            return (
                                                <div
                                                    key={`${r}-${c}`}
                                                    onClick={() => onSquareClick(r, c)}
                                                    className="relative flex items-center justify-center cursor-pointer select-none aspect-square transition-all"
                                                    style={{
                                                        background: isLight ? theme.light : theme.dark,
                                                        outline: isSelected
                                                            ? "3px solid rgba(99,102,241,0.8)"
                                                            : undefined,
                                                    }}
                                                >
                                                    {cell && (
                                                        <div className="text-5xl">
                                                            {pieces[cell.color + cell.kind]}
                                                        </div>
                                                    )}
                                                    {isTarget && (
                                                        <div className="absolute w-4 h-4 rounded-full bg-emerald-500/85"></div>
                                                    )}
                                                </div>
                                            );
                                        })
                                    )}
                                </div>

                                <div className="mt-4 flex gap-2 items-center">
                                    <button
                                        onClick={reset}
                                        className="px-3 py-1 rounded-lg bg-white/10 text-white"
                                    >
                                        Reset
                                    </button>
                                    <select
                                        value={themeIndex}
                                        onChange={(e) => setThemeIndex(parseInt(e.target.value))}
                                        className="px-3 py-1 rounded-lg bg-white/10 text-white cursor-pointer"
                                    >
                                        {themes.map((t, i) => (
                                            <option key={i} value={i}>
                                                {t.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* –ò—Å—Ç–æ—Ä–∏—è */}
                        <div className="col-span-1">
                            <div className="p-4 rounded-xl shadow-xl bg-white/5 h-full">
                                <h3 className="text-white font-semibold mb-2">–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h3>
                                <div className="h-96 overflow-auto text-sm text-gray-200 p-2 bg-black/20 rounded">
                                    <div className="text-gray-400">–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ö–æ–¥–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –º–∞—Ç–µ */}
                    {winner && (
                        <div className="fixed inset-0 flex items-center justify-center bg-black/70 z-50">
                            <div className="bg-white text-gray-900 rounded-xl shadow-xl p-6 text-center max-w-sm">
                                <h2 className="text-2xl font-bold mb-2">–ú–∞—Ç!</h2>
                                <p className="mb-4">
                                    –ü–æ–±–µ–¥–∏–ª–∏ {winner === "w" ? "–ë–µ–ª—ã–µ" : "–ß—ë—Ä–Ω—ã–µ"} üéâ
                                </p>
                                <button
                                    onClick={reset}
                                    className="px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700"
                                >
                                    Reset
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<ChessGame />);
    </script>
</body>

</html>
